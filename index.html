<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BotXlab - Docs & Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        github: {
                            bg: '#0d1117',
                            card: '#161b22',
                            border: '#30363d',
                            accent: '#58a6ff',
                            text: '#c9d1d9',
                            muted: '#8b949e',
                            header: '#010409',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #0d1117; 
            color: #c9d1d9;
            /* Subtle lighting effect */
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(88, 166, 255, 0.04), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(163, 113, 247, 0.04), transparent 25%);
            background-attachment: fixed;
        }
        
        /* Smooth Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #58a6ff; }

        /* Typography & Markdown Polish */
        .markdown-body { font-size: 15px; line-height: 1.7; color: #c9d1d9; }
        .markdown-body h1, .markdown-body h2 { 
            color: #ffffff; margin-top: 2em; margin-bottom: 1rem; font-weight: 700; 
            letter-spacing: -0.02em; border-bottom: 1px solid #21262d; padding-bottom: 0.3em;
            scroll-margin-top: 100px;
        }
        .markdown-body h1 { font-size: 2.2em; border-bottom: none; } 
        .markdown-body h3 { color: #f0f6fc; margin-top: 1.5em; font-weight: 600; }
        .markdown-body a { color: #58a6ff; text-decoration: none; transition: color 0.2s; }
        .markdown-body a:hover { color: #79c0ff; text-decoration: underline; }
        .markdown-body p { margin-bottom: 1.2em; }
        .markdown-body ul { padding-left: 1.5em; list-style-type: disc; margin-bottom: 1.2em; }
        .markdown-body li { margin-bottom: 0.4em; }
        
        /* Enhanced Code Blocks */
        .markdown-body pre { 
            background-color: #161b22; padding: 1.2em; overflow: auto; 
            border-radius: 8px; margin-bottom: 1.5em; border: 1px solid #30363d; 
            position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .markdown-body code { 
            background-color: rgba(110,118,129,0.15); padding: 0.2em 0.4em; 
            border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.9em; color: #e6edf3;
        }
        .markdown-body pre code { background-color: transparent; padding: 0; color: inherit; }
        
        .copy-btn {
            position: absolute; top: 10px; right: 10px;
            background: rgba(33, 38, 45, 0.8); border: 1px solid rgba(240, 246, 252, 0.1);
            color: #8b949e; border-radius: 6px; padding: 4px 8px; font-size: 11px; font-family: 'Inter', sans-serif;
            opacity: 0; transition: all 0.2s ease; cursor: pointer; backdrop-filter: blur(4px);
        }
        .markdown-body pre:hover .copy-btn { opacity: 1; }
        .copy-btn:hover { background: #30363d; color: #f0f6fc; border-color: #8b949e; }

        .markdown-body blockquote { 
            border-left: 3px solid #30363d; padding: 0.5em 1em; color: #8b949e; background: rgba(22, 27, 34, 0.5);
        }
        .markdown-body img { max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .markdown-body table { border-collapse: collapse; width: 100%; margin-bottom: 1.5em; font-size: 0.95em; }
        .markdown-body th, .markdown-body td { border: 1px solid #30363d; padding: 8px 16px; }
        .markdown-body th { background-color: #161b22; font-weight: 600; text-align: left; }

        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(22, 27, 34, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(48, 54, 61, 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        /* Navigation Tabs Animation */
        .nav-item {
            position: relative;
            color: #8b949e;
            transition: color 0.3s ease;
        }
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #58a6ff;
            transform: scaleX(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
            box-shadow: 0 -2px 6px rgba(88, 166, 255, 0.4);
        }
        .nav-item:hover { color: #c9d1d9; }
        .nav-item.active { color: #f0f6fc; }
        .nav-item.active::after { transform: scaleX(1); }
        
        /* Auto TOC Styles */
        .toc-link {
            display: block;
            padding: 4px 0 4px 16px;
            color: #8b949e;
            font-size: 0.85rem;
            text-decoration: none;
            border-left: 2px solid transparent;
            transition: all 0.2s ease;
            position: relative;
        }
        .toc-link:hover { color: #58a6ff; }
        .toc-link::before {
            content: ''; position: absolute; left: -2px; top: 0; bottom: 0; width: 2px;
            background: transparent; transition: background 0.2s;
        }
        .toc-link:hover::before { background: #58a6ff; }
        .toc-h1 { font-weight: 600; color: #c9d1d9; margin-top: 8px; }
        .toc-h2 { margin-left: 0px; }
        .toc-h3 { margin-left: 12px; font-size: 0.8rem; opacity: 0.8; }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Skeleton Animation */
        .skeleton {
            background-color: #21262d;
            background-image: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0,
                rgba(255, 255, 255, 0.05) 20%,
                rgba(255, 255, 255, 0.1) 60%,
                rgba(255, 255, 255, 0)
            );
            background-size: 200px 100%;
            background-repeat: no-repeat;
            background-position: -200px 0;
            animation: skeleton-load 1.5s infinite;
        }

        @keyframes skeleton-load {
            to {
                background-position: calc(100% + 200px) 0;
            }
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden selection:bg-github-accent selection:text-white font-sans text-sm">

    <!-- Sidebar -->
    <aside class="w-72 bg-[#010409]/95 border-r border-github-border flex flex-col flex-shrink-0 z-30 shadow-2xl backdrop-blur-md" id="sidebar">
        <!-- Sidebar Header -->
        <div class="p-5">
            <button onclick="showDashboard()" class="w-full flex items-center gap-3 text-lg font-bold text-white tracking-tight hover:opacity-80 transition-opacity mb-6 group">
                <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-600 text-white rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20 group-hover:shadow-blue-500/40 transition-all duration-300">
                    <i data-lucide="box" class="w-5 h-5"></i>
                </div>
                BotXlab
            </button>
            
            <div class="relative group">
                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-github-muted group-focus-within:text-github-accent transition-colors"></i>
                <input type="text" id="search-input" placeholder="Search repositories..." 
                    class="w-full bg-[#0d1117] border border-github-border rounded-lg py-2 pl-10 pr-12 text-sm text-white placeholder-github-muted focus:border-github-accent focus:outline-none focus:ring-1 focus:ring-github-accent/50 transition-all shadow-sm">
                <!-- Keyboard Shortcut Hint -->
                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none flex items-center gap-1">
                    <span class="text-[10px] text-github-muted bg-github-border/50 px-1.5 py-0.5 rounded font-mono border border-github-border/50">⌘K</span>
                </div>
            </div>
        </div>

        <!-- Project List -->
        <div class="flex-1 overflow-y-auto px-3">
            <div class="flex items-center justify-between mb-3 px-2">
                <h3 class="text-[11px] font-bold text-github-muted uppercase tracking-widest">Repositories</h3>
                <span id="repo-count" class="text-[10px] bg-github-border text-github-muted px-2 py-0.5 rounded-full font-mono">0</span>
            </div>
            
            <div id="repo-list" class="space-y-0.5 pb-4">
                <!-- Repos inserted via JS -->
            </div>
        </div>

        <!-- Sidebar Footer -->
        <div class="p-4 border-t border-github-border flex justify-between items-center bg-[#010409]">
            <div class="flex items-center gap-3">
                <button onclick="openSettings()" class="text-github-muted hover:text-white transition-colors p-1.5 hover:bg-github-border rounded-md" title="API Settings">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                </button>
                <span class="flex items-center gap-2 text-[10px] text-github-muted font-mono uppercase tracking-wide opacity-70">
                    <span id="auto-sync-status" class="w-1.5 h-1.5 rounded-full bg-github-muted"></span>
                    <span id="last-sync-time">Just now</span>
                </span>
            </div>
            <button onclick="autoDiscoverRepos(true)" class="text-github-muted hover:text-white transition-colors p-1.5 hover:bg-github-border rounded-md" title="Force Refresh">
                <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full relative overflow-hidden">
        
        <!-- Top Navigation Bar -->
        <header class="h-16 border-b border-github-border bg-[#0d1117]/80 backdrop-blur-md flex items-center justify-between px-8 sticky top-0 z-20 shrink-0 shadow-sm">
            <div class="flex items-center gap-6 overflow-hidden w-full h-full">
                <!-- Back Button (Mobile/Context) -->
                <button onclick="showDashboard()" id="back-dash-btn" class="hidden p-2 hover:bg-github-border rounded-lg text-github-muted hover:text-white transition-colors">
                    <i data-lucide="layout-grid" class="w-5 h-5"></i>
                </button>
                
                <!-- Breadcrumbs / Title -->
                <div class="flex flex-col overflow-hidden justify-center h-full">
                    <div class="flex items-center gap-2">
                        <span class="text-github-muted text-sm font-light hidden md:inline opacity-60">BotXlab /</span>
                        <h2 id="header-title" class="text-base font-semibold text-white truncate tracking-tight">Dashboard</h2>
                    </div>
                    
                    <!-- Smart Context Bar (Visible on Project View) -->
                    <div id="smart-context" class="hidden flex items-center gap-3 mt-0.5 text-xs text-github-muted overflow-x-auto hide-scrollbar">
                          <!-- Injected via JS -->
                    </div>
                </div>

                <!-- Tabs (Visible only when repo selected) -->
                <div id="repo-tabs" class="hidden flex items-center gap-8 ml-auto h-full flex-shrink-0">
                    <button onclick="switchTab('readme')" id="tab-readme" class="nav-item active h-full flex items-center gap-2 text-sm font-medium px-1 relative">
                        <i data-lucide="book-open" class="w-4 h-4 opacity-70"></i> <span class="hidden md:inline">README</span>
                    </button>
                    <button onclick="switchTab('releases')" id="tab-releases" class="nav-item h-full flex items-center gap-2 text-sm font-medium px-1 relative">
                        <i data-lucide="tag" class="w-4 h-4 opacity-70"></i> <span class="hidden md:inline">Releases</span>
                    </button>
                    <button onclick="switchTab('commits')" id="tab-commits" class="nav-item h-full flex items-center gap-2 text-sm font-medium px-1 relative">
                        <i data-lucide="git-commit" class="w-4 h-4 opacity-70"></i> <span class="hidden md:inline">Commits</span>
                    </button>
                    <button onclick="switchTab('collaborators')" id="tab-collaborators" class="nav-item h-full flex items-center gap-2 text-sm font-medium px-1 relative">
                        <i data-lucide="users" class="w-4 h-4 opacity-70"></i> <span class="hidden md:inline">Collaborators</span>
                    </button>
                </div>

                <!-- Right Side Actions -->
                <div id="header-actions" class="hidden md:flex ml-6 items-center gap-3 border-l border-github-border pl-6 h-8 my-auto">
                    <!-- Actions injected via JS -->
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <div id="content-scroll" class="flex-1 overflow-y-auto scroll-smooth">
            <div class="max-w-7xl mx-auto p-8 min-h-full">
                
                <!-- DASHBOARD VIEW -->
                <div id="dashboard-view" class="animate-fade-in">
                    <!-- Hero Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                        <!-- Stat Card 1 -->
                        <div class="glass-panel rounded-xl p-6 relative overflow-hidden group hover:border-blue-500/30 transition-all duration-300">
                            <div class="absolute -right-6 -top-6 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl group-hover:bg-blue-500/20 transition-all duration-500"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-github-muted text-xs font-bold uppercase tracking-wider">Total Projects</p>
                                    <i data-lucide="folder-git-2" class="w-4 h-4 text-blue-400 opacity-80"></i>
                                </div>
                                <div class="text-4xl font-bold text-white tracking-tight" id="stat-total-repos">0</div>
                            </div>
                        </div>
                        
                        <!-- Stat Card 2 -->
                        <div class="glass-panel rounded-xl p-6 relative overflow-hidden group hover:border-yellow-500/30 transition-all duration-300">
                            <div class="absolute -right-6 -top-6 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl group-hover:bg-yellow-500/20 transition-all duration-500"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-github-muted text-xs font-bold uppercase tracking-wider">Total Stars</p>
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-400 opacity-80"></i>
                                </div>
                                <div class="text-4xl font-bold text-white tracking-tight" id="stat-total-stars">0</div>
                            </div>
                        </div>
                        
                        <!-- Stat Card 3 -->
                        <div class="glass-panel rounded-xl p-6 relative overflow-hidden group hover:border-purple-500/30 transition-all duration-300">
                            <div class="absolute -right-6 -top-6 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl group-hover:bg-purple-500/20 transition-all duration-500"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-github-muted text-xs font-bold uppercase tracking-wider">Top Language</p>
                                    <i data-lucide="code-2" class="w-4 h-4 text-purple-400 opacity-80"></i>
                                </div>
                                <div class="text-4xl font-bold text-white tracking-tight truncate" id="stat-top-lang">-</div>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2.5">
                        <div class="p-1.5 bg-yellow-500/10 rounded-md">
                            <i data-lucide="sparkles" class="text-yellow-400 w-4 h-4"></i>
                        </div>
                        Featured Projects
                    </h3>

                    <div id="recent-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Grid items via JS -->
                    </div>
                </div>

                <!-- PROJECT VIEW -->
                <div id="project-view" class="hidden animate-fade-in flex gap-8">
                    
                    <!-- Main Content Column -->
                    <div class="flex-1 min-w-0">
                        <!-- README TAB CONTENT -->
                        <div id="content-readme" class="hidden">
                            <article id="readme-container" class="markdown-body bg-transparent animate-slide-up">
                                <!-- README HTML injected here -->
                            </article>
                        </div>

                        <!-- RELEASES TAB CONTENT -->
                        <div id="content-releases" class="hidden animate-slide-up">
                            <div id="releases-container" class="space-y-6">
                                <!-- Releases injected here -->
                            </div>
                        </div>

                        <!-- COMMITS TAB CONTENT -->
                        <div id="content-commits" class="hidden animate-slide-up">
                            <div id="commits-container" class="space-y-0">
                                <!-- Commits injected here -->
                            </div>
                        </div>

                        <!-- COLLABORATORS TAB CONTENT -->
                        <div id="content-collaborators" class="hidden animate-slide-up">
                            <div id="collaborators-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                <!-- Collaborators injected here -->
                            </div>
                        </div>

                        <!-- ERROR STATE -->
                        <div id="error-state" class="hidden flex flex-col items-center justify-center py-24 text-center border border-dashed border-github-border rounded-xl bg-github-card/50">
                            <div class="w-14 h-14 bg-github-card rounded-full flex items-center justify-center mb-4 shadow-sm border border-github-border">
                                <i data-lucide="file-warning" class="w-7 h-7 text-github-muted"></i>
                            </div>
                            <h3 class="text-lg font-medium text-white mb-2">Nothing to show</h3>
                            <p class="text-github-muted max-w-md text-sm leading-relaxed" id="error-msg">No content available for this section.</p>
                        </div>
                    </div>

                    <!-- Right Sidebar (TOC) - Only visible on README tab -->
                    <div id="toc-sidebar" class="hidden w-72 flex-shrink-0 relative">
                        <div class="sticky top-6">
                            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-github-accent/50">
                                <h4 class="text-xs font-bold text-white mb-4 uppercase tracking-widest flex items-center gap-2">
                                    <i data-lucide="list" class="w-3 h-3 text-github-accent"></i>
                                    On this page
                                </h4>
                                <nav id="toc-content" class="space-y-1 max-h-[70vh] overflow-y-auto pr-2 custom-scrollbar">
                                    <!-- TOC generated here -->
                                </nav>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-[#161b22] border border-github-border rounded-xl shadow-2xl w-full max-w-md p-6 transform transition-all scale-100 relative overflow-hidden">
            <!-- Decorative blur -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div>
            
            <div class="flex justify-between items-center mb-6 relative z-10">
                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                    <i data-lucide="shield" class="w-5 h-5 text-github-accent"></i>
                    Configuration
                </h3>
                <button onclick="closeSettings()" class="text-github-muted hover:text-white transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <div class="space-y-5 relative z-10">
                <!-- Org Setting -->
                <div>
                    <label class="block text-sm font-medium text-github-muted mb-2">GitHub User or Organization</label>
                    <div class="relative">
                        <i data-lucide="user" class="absolute left-3 top-2.5 w-4 h-4 text-github-muted"></i>
                        <input type="text" id="api-org-input" placeholder="e.g. facebook, google, botxlab" class="w-full bg-[#0d1117] border border-github-border rounded-lg py-2 pl-10 pr-3 text-white focus:border-github-accent focus:outline-none focus:ring-1 focus:ring-github-accent transition-all text-sm font-mono shadow-inner">
                    </div>
                </div>

                <!-- Token Setting -->
                <div>
                    <label class="block text-sm font-medium text-github-muted mb-2">GitHub Personal Access Token</label>
                    <div class="relative">
                        <i data-lucide="key" class="absolute left-3 top-2.5 w-4 h-4 text-github-muted"></i>
                        <input type="password" id="api-token-input" placeholder="ghp_xxxxxxxxxxxx" class="w-full bg-[#0d1117] border border-github-border rounded-lg py-2 pl-10 pr-3 text-white focus:border-github-accent focus:outline-none focus:ring-1 focus:ring-github-accent transition-all text-sm font-mono shadow-inner">
                    </div>
                </div>
                
                <div class="bg-blue-900/10 border border-blue-500/20 p-4 rounded-lg text-xs text-blue-200 leading-relaxed flex gap-3">
                    <i data-lucide="info" class="w-4 h-4 text-blue-400 flex-shrink-0 mt-0.5"></i>
                    <div>
                        <strong>Why is this needed?</strong><br>
                        Without a token, GitHub limits you to 60 requests/hour. Adding a token increases this limit to 5000/hour. Data is stored locally in your browser.
                    </div>
                </div>
            </div>

            <div class="mt-8 flex justify-end gap-3 relative z-10">
                <button onclick="closeSettings()" class="text-sm font-medium text-github-muted hover:text-white px-4 py-2 transition-colors rounded-lg hover:bg-white/5">Cancel</button>
                <button onclick="saveSettings()" class="bg-github-accent hover:bg-blue-500 text-white px-5 py-2 rounded-lg font-medium text-sm transition-all shadow-lg shadow-blue-500/20 active:transform active:scale-95">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration & State ---
        // Mise à jour de la clé de cache en v6 pour forcer le rechargement des données (incluant clone_url)
        const state = {
            repos: JSON.parse(localStorage.getItem('botxlab_cache_v6')) || [],
            token: localStorage.getItem('botxlab_token') || '',
            org: localStorage.getItem('botxlab_org') || 'botxlab', // Default to botxlab
            currentRepo: null,
            lastSync: parseInt(localStorage.getItem('botxlab_last_sync_v6')) || 0,
            activeTab: 'readme'
        };

        const els = {
            repoList: document.getElementById('repo-list'),
            repoCount: document.getElementById('repo-count'),
            searchInput: document.getElementById('search-input'),
            dashboardView: document.getElementById('dashboard-view'),
            projectView: document.getElementById('project-view'),
            recentGrid: document.getElementById('recent-grid'),
            
            // Settings
            settingsModal: document.getElementById('settings-modal'),
            tokenInput: document.getElementById('api-token-input'),
            orgInput: document.getElementById('api-org-input'),
            
            // Header
            headerTitle: document.getElementById('header-title'),
            smartContext: document.getElementById('smart-context'),
            backBtn: document.getElementById('back-dash-btn'),
            repoTabs: document.getElementById('repo-tabs'),
            headerActions: document.getElementById('header-actions'),
            
            // Tabs
            tabReadme: document.getElementById('tab-readme'),
            tabReleases: document.getElementById('tab-releases'),
            tabCommits: document.getElementById('tab-commits'),
            tabCollaborators: document.getElementById('tab-collaborators'),
            
            // Content Containers
            contentReadme: document.getElementById('content-readme'),
            contentReleases: document.getElementById('content-releases'),
            contentCommits: document.getElementById('content-commits'),
            contentCollaborators: document.getElementById('content-collaborators'),
            
            readmeContainer: document.getElementById('readme-container'),
            releasesContainer: document.getElementById('releases-container'),
            commitsContainer: document.getElementById('commits-container'),
            collaboratorsGrid: document.getElementById('collaborators-grid'),
            tocSidebar: document.getElementById('toc-sidebar'),
            tocContent: document.getElementById('toc-content'),

            // States
            errorState: document.getElementById('error-state'),
            errorMsg: document.getElementById('error-msg'),
            
            // Stats
            statRepos: document.getElementById('stat-total-repos'),
            statStars: document.getElementById('stat-total-stars'),
            statLang: document.getElementById('stat-top-lang'),
            
            // Footer
            syncStatus: document.getElementById('auto-sync-status'),
            lastSyncTime: document.getElementById('last-sync-time')
        };

        // --- Keyboard Shortcuts ---
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + K to search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                els.searchInput.focus();
            }
            // Escape to close/clear
            if (e.key === 'Escape') {
                if (!els.settingsModal.classList.contains('hidden')) {
                    closeSettings();
                } else if (document.activeElement === els.searchInput) {
                    els.searchInput.blur();
                } else if (els.searchInput.value) {
                    els.searchInput.value = '';
                    renderSidebar(); // Reset filter
                }
            }
        });

        // --- Skeleton Loading Helpers ---
        function renderSkeleton(type, count = 1) {
            let html = '';
            
            if (type === 'sidebar') {
                for(let i=0; i<6; i++) {
                    html += `
                        <div class="px-3 py-2.5 flex items-center gap-3 animate-pulse">
                            <div class="w-1.5 h-1.5 rounded-full bg-github-border"></div>
                            <div class="h-4 bg-github-border rounded w-3/4"></div>
                        </div>
                    `;
                }
            }
            else if (type === 'card') {
                 // For dashboard grid
                 for(let i=0; i<6; i++) {
                    html += `
                        <div class="glass-panel p-6 rounded-xl animate-pulse">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-2.5 w-full">
                                    <div class="w-6 h-6 bg-github-border rounded"></div>
                                    <div class="h-5 bg-github-border rounded w-1/2"></div>
                                </div>
                            </div>
                            <div class="space-y-2 mb-6">
                                <div class="h-3 bg-github-border rounded w-full"></div>
                                <div class="h-3 bg-github-border rounded w-4/5"></div>
                            </div>
                            <div class="flex justify-between mt-auto pt-4 border-t border-white/5">
                                <div class="w-12 h-3 bg-github-border rounded"></div>
                                <div class="w-8 h-3 bg-github-border rounded"></div>
                            </div>
                        </div>
                    `;
                 }
            }
            else if (type === 'readme') {
                html = `
                    <div class="animate-pulse space-y-6 max-w-3xl">
                        <div class="h-10 bg-github-border rounded w-1/3 mb-8"></div>
                        <div class="space-y-3">
                            <div class="h-4 bg-github-border rounded w-full"></div>
                            <div class="h-4 bg-github-border rounded w-full"></div>
                            <div class="h-4 bg-github-border rounded w-3/4"></div>
                        </div>
                        <div class="h-40 bg-github-border rounded w-full my-6"></div>
                        <div class="space-y-3">
                            <div class="h-4 bg-github-border rounded w-full"></div>
                            <div class="h-4 bg-github-border rounded w-5/6"></div>
                        </div>
                    </div>
                `;
            }
            else if (type === 'releases') {
                for(let i=0; i<2; i++) {
                    html += `
                        <div class="glass-panel p-6 rounded-xl border border-github-border mb-6 animate-pulse">
                            <div class="flex justify-between items-start mb-4">
                                <div class="w-1/2">
                                    <div class="h-6 bg-github-border rounded w-1/3 mb-2"></div>
                                    <div class="h-3 bg-github-border rounded w-1/4"></div>
                                </div>
                                <div class="w-20 h-8 bg-github-border rounded"></div>
                            </div>
                            <div class="space-y-2 mt-4">
                                <div class="h-3 bg-github-border rounded w-full"></div>
                                <div class="h-3 bg-github-border rounded w-full"></div>
                                <div class="h-3 bg-github-border rounded w-2/3"></div>
                            </div>
                        </div>
                    `;
                }
            }
            else if (type === 'commits') {
                html += '<div class="glass-panel rounded-xl border border-github-border overflow-hidden animate-pulse">';
                for(let i=0; i<5; i++) {
                    html += `
                        <div class="p-4 border-b border-github-border flex gap-4">
                            <div class="w-4 h-4 rounded-full bg-github-border"></div>
                            <div class="flex-1">
                                <div class="h-4 bg-github-border rounded w-2/3 mb-2"></div>
                                <div class="h-3 bg-github-border rounded w-1/4"></div>
                            </div>
                            <div class="w-16 h-6 bg-github-border rounded"></div>
                        </div>
                    `;
                }
                html += '</div>';
            }
            else if (type === 'collaborators') {
                for(let i=0; i<6; i++) {
                    html += `
                        <div class="glass-panel p-4 rounded-xl border border-github-border flex items-center gap-4 animate-pulse">
                            <div class="w-12 h-12 rounded-full bg-github-border"></div>
                            <div class="flex-1">
                                <div class="h-4 bg-github-border rounded w-1/2 mb-2"></div>
                                <div class="h-3 bg-github-border rounded w-1/3"></div>
                            </div>
                        </div>
                    `;
                }
            }
            
            return html;
        }

        // --- Utility: Auto Color Generation ---
        function stringToColor(str) {
            if(!str) return '#8b949e'; // Default gray
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
            return '#' + "00000".substring(0, 6 - c.length) + c;
        }

        // --- Utility: Time Ago ---
        function timeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + "y ago";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + "mo ago";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + "d ago";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + "h ago";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + "m ago";
            return Math.floor(seconds) + "s ago";
        }

        // --- Utility: Fix Readme Relative Links ---
        function fixReadmeContent(html, repoFullname, defaultBranch) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const branch = defaultBranch || 'master';
            const baseUrl = `https://raw.githubusercontent.com/${repoFullname}/${branch}/`;

            doc.querySelectorAll('img').forEach(img => {
                const src = img.getAttribute('src');
                if (src && !src.startsWith('http') && !src.startsWith('data:')) {
                    const cleanPath = src.replace(/^\.\//, '');
                    img.src = baseUrl + cleanPath;
                }
            });

            doc.querySelectorAll('a').forEach(a => {
                const href = a.getAttribute('href');
                if (href && !href.startsWith('http') && !href.startsWith('#') && !href.startsWith('mailto:')) {
                    const cleanPath = href.replace(/^\.\//, '');
                    a.href = `https://github.com/${repoFullname}/blob/${branch}/${cleanPath}`;
                    a.target = "_blank";
                }
            });

            return doc.body.innerHTML;
        }

        // --- Init ---
        window.addEventListener('DOMContentLoaded', init);

        async function init() {
            lucide.createIcons();
            els.searchInput.addEventListener('input', (e) => renderSidebar(e.target.value));
            
            // Init Settings fields
            els.tokenInput.value = state.token;
            els.orgInput.value = state.org;

            if (state.repos.length > 0) {
                updateStats();
                renderSidebar();
                renderDashboard();
            }

            if (state.repos.length === 0 || (Date.now() - state.lastSync > 900000)) {
                await autoDiscoverRepos();
            }
        }

        // --- Auth Helper ---
        function getHeaders(extraHeaders = {}) {
            const headers = { 'Accept': 'application/vnd.github.v3+json', ...extraHeaders };
            if (state.token) {
                headers['Authorization'] = `Bearer ${state.token}`;
            }
            return headers;
        }

        // --- Settings UI ---
        function openSettings() { els.settingsModal.classList.remove('hidden'); }
        function closeSettings() { els.settingsModal.classList.add('hidden'); }
        
        function saveSettings() {
            state.token = els.tokenInput.value.trim();
            state.org = els.orgInput.value.trim() || 'botxlab'; // Default fallback
            
            localStorage.setItem('botxlab_token', state.token);
            localStorage.setItem('botxlab_org', state.org);
            
            closeSettings();
            
            // Clear cache and reload for new org
            state.repos = [];
            state.lastSync = 0;
            localStorage.removeItem('botxlab_cache_v6');
            
            // Trigger refresh
            autoDiscoverRepos(true); 
        }

        // --- Data Fetching ---

        async function autoDiscoverRepos(force = false) {
            els.syncStatus.className = "w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse";
            els.lastSyncTime.textContent = "Syncing...";
            
            // Show Skeleton in sidebar if force refresh
            if(force) {
                els.repoList.innerHTML = renderSkeleton('sidebar');
            }

            try {
                let url = `https://api.github.com/orgs/${state.org}/repos?sort=updated&per_page=100&type=all`;
                let response = await fetch(url, { headers: getHeaders() });
                
                // Fallback to User if Org 404s
                if (response.status === 404) {
                     url = `https://api.github.com/users/${state.org}/repos?sort=updated&per_page=100&type=all`;
                     response = await fetch(url, { headers: getHeaders() });
                }

                if (!response.ok) {
                    if (response.status === 403) throw new Error("Rate Limit Exceeded. Add Token.");
                    if (response.status === 404) throw new Error(`User/Org '${state.org}' not found`);
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (!Array.isArray(data)) throw new Error("Invalid Data");
                
                const processedRepos = data.map(repo => ({
                    name: repo.name,
                    full_name: repo.full_name,
                    description: repo.description,
                    stars: repo.stargazers_count,
                    updated_at: repo.pushed_at,
                    language: repo.language,
                    html_url: repo.html_url,
                    clone_url: repo.clone_url,
                    default_branch: repo.default_branch,
                    homepage: repo.homepage,
                    license: repo.license ? repo.license.spdx_id : null,
                    open_issues: repo.open_issues_count,
                    topics: repo.topics || [] 
                }));

                processedRepos.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));

                state.repos = processedRepos;
                state.lastSync = Date.now();
                
                localStorage.setItem('botxlab_cache_v6', JSON.stringify(state.repos));
                localStorage.setItem('botxlab_last_sync_v6', state.lastSync);

                updateStats();
                renderSidebar();
                
                if(!state.currentRepo) renderDashboard();
                
                els.syncStatus.className = "w-1.5 h-1.5 rounded-full bg-green-500";
                els.lastSyncTime.textContent = "Just now";

            } catch (error) {
                console.warn(error);
                els.syncStatus.className = "w-1.5 h-1.5 rounded-full bg-red-500";
                els.lastSyncTime.textContent = "Failed";
                
                els.repoList.innerHTML = `<div class="text-xs text-red-400 px-4 py-8 text-center bg-red-500/10 rounded mx-2 mt-4"><i data-lucide="alert-triangle" class="w-5 h-5 mx-auto mb-2"></i><br>${error.message}</div>`;
                lucide.createIcons();
            }
        }

        function updateStats() {
            const langCounts = {};
            state.repos.forEach(r => {
                if(r.language) langCounts[r.language] = (langCounts[r.language] || 0) + 1;
            });
            const topLang = Object.keys(langCounts).reduce((a, b) => langCounts[a] > langCounts[b] ? a : b, 'None');

            els.statRepos.textContent = state.repos.length;
            els.repoCount.textContent = state.repos.length;
            els.statStars.textContent = state.repos.reduce((acc, r) => acc + (r.stars || 0), 0);
            els.statLang.textContent = topLang;
        }

        // --- Sidebar & Dashboard Rendering ---

        function renderSidebar(filter = "") {
            els.repoList.innerHTML = '';
            
            const filtered = state.repos.filter(r => r.name.toLowerCase().includes(filter.toLowerCase()));

            if (filtered.length === 0) {
                els.repoList.innerHTML = `<div class="text-xs text-github-muted px-4 py-4 text-center italic">No repositories found.</div>`;
                return;
            }

            filtered.forEach(repo => {
                const btn = document.createElement('button');
                const isActive = state.currentRepo && state.currentRepo.full_name === repo.full_name;
                const langColor = stringToColor(repo.language);

                btn.className = `w-full text-left px-3 py-2.5 rounded-lg transition-all group flex items-center justify-between
                    ${isActive ? 'bg-github-card/80 border-l-2 border-l-github-accent shadow-lg shadow-black/20' : 'hover:bg-white/5 border-l-2 border-l-transparent'}`;
                
                btn.innerHTML = `
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="w-1.5 h-1.5 rounded-full flex-shrink-0 shadow-sm" style="background-color: ${langColor}; box-shadow: 0 0 5px ${langColor}40"></div>
                        <span class="text-sm font-medium truncate ${isActive ? 'text-white' : 'text-github-muted group-hover:text-github-text'}">
                            ${repo.name}
                        </span>
                    </div>
                `;
                btn.onclick = () => loadProject(repo);
                els.repoList.appendChild(btn);
            });
        }

        function renderDashboard() {
            state.currentRepo = null;
            els.headerTitle.textContent = `${state.org} / Dashboard`;
            els.smartContext.innerHTML = ""; 
            els.smartContext.classList.add('hidden');
            els.backBtn.classList.add('hidden');
            els.repoTabs.classList.add('hidden');
            els.headerActions.innerHTML = ''; // Clear header actions
            
            els.projectView.classList.add('hidden');
            els.dashboardView.classList.remove('hidden');

            // Use Skeleton if data is missing, otherwise show cards
            if(state.repos.length === 0) {
                els.recentGrid.innerHTML = renderSkeleton('card');
            } else {
                els.recentGrid.innerHTML = '';
                state.repos.slice(0, 6).forEach(repo => {
                    const card = document.createElement('div');
                    card.className = "glass-panel p-6 rounded-xl cursor-pointer hover:border-github-accent/50 transition-all hover:-translate-y-1 hover:shadow-2xl hover:shadow-blue-500/10 group";
                    card.onclick = () => loadProject(repo);
                    
                    const langColor = stringToColor(repo.language);
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-2.5">
                                <div class="p-1.5 bg-white/5 rounded-md group-hover:bg-github-accent/10 transition-colors">
                                    <i data-lucide="book" class="w-4 h-4 text-github-muted group-hover:text-github-accent transition-colors"></i>
                                </div>
                                <span class="text-white font-semibold group-hover:text-github-accent transition-colors text-base">${repo.name}</span>
                            </div>
                        </div>
                        <p class="text-sm text-github-muted mb-6 line-clamp-2 h-10 leading-relaxed opacity-80">
                            ${repo.description || "No description provided."}
                        </p>
                        <div class="flex items-center gap-3 text-xs justify-between mt-auto border-t border-white/5 pt-4">
                            <div class="flex items-center gap-3">
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2 h-2 rounded-full" style="background-color: ${langColor}"></span>
                                    <span class="text-github-text">${repo.language || 'N/A'}</span>
                                </div>
                            </div>
                            <span class="text-github-muted whitespace-nowrap flex items-center gap-1.5">
                                <i data-lucide="star" class="w-3 h-3 text-yellow-500/80"></i> ${repo.stars}
                            </span>
                        </div>
                    `;
                    els.recentGrid.appendChild(card);
                });
            }
            lucide.createIcons();
        }

        function showDashboard() {
            renderSidebar(els.searchInput.value); 
            renderDashboard();
        }

        // --- Project View Logic ---

        function loadProject(repo) {
            state.currentRepo = repo;
            renderSidebar(els.searchInput.value);

            els.dashboardView.classList.add('hidden');
            els.projectView.classList.remove('hidden');
            
            els.headerTitle.textContent = repo.name;
            els.backBtn.classList.remove('hidden');
            els.repoTabs.classList.remove('hidden');
            
            // Header Actions (Clone & Github Link)
            // Bouton de clonage avec icône "code" et style identique au bouton GitHub
            // Modification : Format 'gh repo clone owner/repo'
            const cloneCommand = `gh repo clone ${repo.full_name}`;

            els.headerActions.innerHTML = `
                <button onclick="copyCloneUrl('${cloneCommand}')" id="btn-clone-url" class="text-github-muted hover:text-white transition-colors p-1.5 hover:bg-github-border rounded-md relative" title="Copier la commande GH CLI">
                    <i data-lucide="code" class="w-5 h-5"></i>
                </button>
                <a id="github-link" href="${repo.html_url}" target="_blank" class="text-github-muted hover:text-white transition-colors p-1.5 hover:bg-github-border rounded-md" title="Ouvrir sur GitHub">
                    <i data-lucide="github" class="w-5 h-5"></i>
                </a>
            `;
            
            // 2. Render Smart Context Bar
            let contextHtml = '';
            if (repo.homepage) {
                contextHtml += `<a href="${repo.homepage}" target="_blank" class="flex items-center gap-1.5 px-2.5 py-1 bg-github-accent/10 text-github-accent rounded-md border border-github-accent/20 hover:bg-github-accent/20 transition-colors">
                    <i data-lucide="globe" class="w-3 h-3"></i> Website
                </a>`;
            }
            contextHtml += `<a href="https://github.com/sponsors/${state.org}" target="_blank" class="flex items-center gap-1.5 px-2.5 py-1 bg-pink-500/10 text-pink-400 rounded-md border border-pink-500/20 hover:bg-pink-500/20 transition-colors">
                <i data-lucide="heart" class="w-3 h-3"></i> Sponsor
            </a>`;
            if (repo.license) {
                contextHtml += `<span class="flex items-center gap-1.5 px-2.5 py-1 bg-github-card border border-github-border rounded-md text-github-text">
                    <i data-lucide="scale" class="w-3 h-3 text-github-muted"></i> ${repo.license}
                </span>`;
            }
             if (repo.open_issues > 0) {
                contextHtml += `<a href="${repo.html_url}/issues" target="_blank" class="flex items-center gap-1.5 px-2.5 py-1 bg-github-card border border-github-border rounded-md hover:border-github-accent hover:text-white transition-colors">
                    <i data-lucide="circle-dot" class="w-3 h-3 text-github-muted"></i> ${repo.open_issues} Issues
                </a>`;
            }
            contextHtml += `<a href="${repo.html_url}/pulls" target="_blank" class="flex items-center gap-1.5 px-2.5 py-1 bg-github-card border border-github-border rounded-md hover:border-github-accent hover:text-white transition-colors">
                <i data-lucide="git-pull-request" class="w-3 h-3 text-github-muted"></i> Pull Requests
            </a>`;
            
            if (contextHtml) {
                els.smartContext.innerHTML = contextHtml;
                els.smartContext.classList.remove('hidden');
            } else {
                els.smartContext.classList.add('hidden');
            }
            lucide.createIcons();

            switchTab('readme');
        }

        function copyCloneUrl(url) {
            const textArea = document.createElement("textarea");
            textArea.value = url;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus(); textArea.select();
            
            try {
                document.execCommand('copy');
                const btn = document.getElementById('btn-clone-url');
                
                // Feedback visuel : Icône check verte temporaire
                btn.innerHTML = `<i data-lucide="check" class="w-5 h-5 text-green-500"></i>`;
                lucide.createIcons();
                
                setTimeout(() => {
                    // Restauration de l'icône originale
                    btn.innerHTML = `<i data-lucide="code" class="w-5 h-5"></i>`;
                    lucide.createIcons();
                }, 2000);
            } catch (err) {
                console.error("Failed to copy", err);
            }
            document.body.removeChild(textArea);
        }

        function switchTab(tabName) {
            state.activeTab = tabName;
            
            [els.tabReadme, els.tabReleases, els.tabCommits, els.tabCollaborators].forEach(t => {
                t.classList.remove('active');
            });
            
            let active;
            if (tabName === 'readme') active = els.tabReadme;
            else if (tabName === 'releases') active = els.tabReleases;
            else if (tabName === 'commits') active = els.tabCommits;
            else if (tabName === 'collaborators') active = els.tabCollaborators;
            
            active.classList.add('active');

            // Hide all
            els.contentReadme.classList.add('hidden');
            els.contentReleases.classList.add('hidden');
            els.contentCommits.classList.add('hidden');
            els.contentCollaborators.classList.add('hidden');
            els.tocSidebar.classList.add('hidden'); // Hide TOC by default
            els.tocSidebar.classList.remove('xl:block'); // Ensure override works
            
            if (tabName === 'readme') {
                els.contentReadme.classList.remove('hidden');
                fetchReadme();
            } else if (tabName === 'releases') {
                els.contentReleases.classList.remove('hidden');
                fetchReleases();
            } else if (tabName === 'commits') {
                els.contentCommits.classList.remove('hidden');
                fetchCommits();
            } else if (tabName === 'collaborators') {
                els.contentCollaborators.classList.remove('hidden');
                fetchCollaborators();
            }
        }

        async function fetchReadme() {
            // Show Skeleton
            els.readmeContainer.innerHTML = renderSkeleton('readme');
            els.contentReadme.classList.remove('hidden');
            els.errorState.classList.add('hidden');
            
            try {
                const response = await fetch(`https://api.github.com/repos/${state.currentRepo.full_name}/readme`, {
                    headers: getHeaders({ 'Accept': 'application/vnd.github.v3.raw' })
                });

                if (!response.ok) throw new Error("README not found.");
                const text = await response.text();
                
                els.readmeContainer.innerHTML = marked.parse(text);
                const fixedHtml = fixReadmeContent(els.readmeContainer.innerHTML, state.currentRepo.full_name, state.currentRepo.default_branch);
                els.readmeContainer.innerHTML = fixedHtml;
                
                addCopyButtons();
                generateTOC(); // Generate TOC after rendering
                
                // Only show sidebar if TOC has content
                if(els.tocContent.children.length > 0) {
                    els.tocSidebar.classList.remove('hidden');
                    els.tocSidebar.classList.add('xl:block');
                }
            } catch (err) {
                // If error, clear skeleton and show error
                els.readmeContainer.innerHTML = ''; 
                els.errorState.classList.remove('hidden');
                els.errorMsg.textContent = err.message;
            }
        }

        function generateTOC() {
            const headings = els.readmeContainer.querySelectorAll('h1, h2, h3');
            els.tocContent.innerHTML = '';
            
            if(headings.length < 2) return; // Don't show TOC for tiny readmes

            headings.forEach((heading, index) => {
                const id = `toc-${index}`;
                heading.id = id;
                
                const link = document.createElement('a');
                link.href = `#${id}`;
                link.textContent = heading.textContent;
                link.className = `toc-link toc-${heading.tagName.toLowerCase()}`;
                link.onclick = (e) => {
                    e.preventDefault();
                    heading.scrollIntoView({ behavior: 'smooth' });
                };
                
                els.tocContent.appendChild(link);
            });
        }

        function addCopyButtons() {
            const preBlocks = document.querySelectorAll('#readme-container pre');
            preBlocks.forEach(pre => {
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerHTML = 'Copy';
                
                btn.onclick = () => {
                    const code = pre.querySelector('code')?.innerText || pre.innerText;
                    
                    const textArea = document.createElement("textarea");
                    textArea.value = code;
                    textArea.style.position = "fixed"; 
                    textArea.style.left = "-9999px";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        document.execCommand('copy');
                        btn.innerHTML = 'Copied!';
                        btn.style.color = '#4ade80';
                        setTimeout(() => {
                            btn.innerHTML = 'Copy';
                            btn.style.color = '';
                        }, 2000);
                    } catch (err) {
                        btn.innerHTML = 'Error';
                        btn.style.color = '#f87171';
                    }
                    
                    document.body.removeChild(textArea);
                };
                
                pre.appendChild(btn);
            });
        }

        async function fetchReleases() {
            // Show Skeleton
            els.releasesContainer.innerHTML = renderSkeleton('releases');
            els.contentReleases.classList.remove('hidden');
            els.errorState.classList.add('hidden');

            try {
                const response = await fetch(`https://api.github.com/repos/${state.currentRepo.full_name}/releases`, { headers: getHeaders() });
                const releases = response.ok ? await response.json() : [];

                if (releases.length === 0) {
                    els.releasesContainer.innerHTML = '';
                    els.errorState.classList.remove('hidden');
                    els.errorMsg.textContent = "No releases found for this project.";
                    return;
                }

                els.releasesContainer.innerHTML = '';
                releases.forEach(release => {
                    const date = new Date(release.published_at).toLocaleDateString();
                    const html = `
                        <div class="glass-panel p-6 rounded-xl border border-github-border mb-6">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-xl font-bold text-white mb-1.5 flex items-center gap-2">
                                        ${release.name || release.tag_name}
                                        <span class="text-[10px] px-2 py-0.5 rounded-full bg-green-500/10 text-green-400 border border-green-500/20 font-mono">Latest</span>
                                    </h3>
                                    <div class="flex items-center gap-2 text-xs text-github-muted">
                                        <i data-lucide="calendar" class="w-3.5 h-3.5"></i> ${date}
                                        <span class="mx-1">•</span>
                                        <span class="font-mono bg-white/5 px-1.5 rounded">${release.tag_name}</span>
                                    </div>
                                </div>
                                <a href="${release.html_url}" target="_blank" class="px-3 py-1.5 text-xs font-medium bg-white/5 hover:bg-white/10 border border-white/10 rounded-md transition-colors text-white">View on GitHub</a>
                            </div>
                            <div class="markdown-body text-sm text-github-text/90">
                                ${marked.parse(release.body || "*No description provided.*")}
                            </div>
                        </div>
                    `;
                    els.releasesContainer.innerHTML += html;
                });
                
                lucide.createIcons();
            } catch (err) {
                els.releasesContainer.innerHTML = '';
                els.errorState.classList.remove('hidden');
                els.errorMsg.textContent = err.message;
            }
        }

        async function fetchCommits() {
            // Show Skeleton
            els.commitsContainer.innerHTML = renderSkeleton('commits');
            els.contentCommits.classList.remove('hidden');
            els.errorState.classList.add('hidden');

            try {
                const response = await fetch(`https://api.github.com/repos/${state.currentRepo.full_name}/commits?per_page=20`, { headers: getHeaders() });
                if (!response.ok) throw new Error("Commits unavailable.");
                const commits = await response.json();

                els.commitsContainer.innerHTML = '';
                const list = document.createElement('div');
                list.className = "glass-panel rounded-xl border border-github-border overflow-hidden";
                
                commits.forEach((item, index) => {
                    const isLast = index === commits.length - 1;
                    const msg = item.commit.message.split('\n')[0];
                    const date = timeAgo(item.commit.author.date);
                    
                    const row = `
                        <div class="p-4 ${!isLast ? 'border-b border-github-border' : ''} hover:bg-white/5 transition-colors flex gap-4 group">
                            <div class="mt-1">
                                <i data-lucide="git-commit" class="w-4 h-4 text-github-muted group-hover:text-github-accent transition-colors"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm text-white font-mono truncate hover:text-github-accent cursor-pointer transition-colors" title="${msg}">${msg}</p>
                                <div class="flex items-center gap-2 mt-1.5 text-xs text-github-muted">
                                    <span class="font-medium text-github-text">${item.commit.author.name}</span>
                                    <span>•</span>
                                    <span>${date}</span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end gap-1">
                                <a href="${item.html_url}" target="_blank" class="text-[10px] font-mono text-github-muted hover:text-white bg-white/5 px-2 py-1 rounded border border-white/5 transition-colors">
                                    ${item.sha.substring(0,7)}
                                </a>
                            </div>
                        </div>
                    `;
                    list.innerHTML += row;
                });
                
                els.commitsContainer.appendChild(list);
                lucide.createIcons();
            } catch (err) {
                els.commitsContainer.innerHTML = '';
                els.errorState.classList.remove('hidden');
                els.errorMsg.textContent = err.message;
            }
        }

        async function fetchCollaborators() {
            // Show Skeleton
            els.collaboratorsGrid.innerHTML = renderSkeleton('collaborators');
            els.contentCollaborators.classList.remove('hidden');
            els.errorState.classList.add('hidden');

            try {
                const response = await fetch(`https://api.github.com/repos/${state.currentRepo.full_name}/contributors`, { headers: getHeaders() });
                
                if (!response.ok) throw new Error("Collaborators information unavailable.");
                const contributors = await response.json();

                if (contributors.length === 0) throw new Error("No contributors found.");

                els.collaboratorsGrid.innerHTML = '';
                contributors.forEach(user => {
                    const card = document.createElement('div');
                    card.className = "glass-panel p-4 rounded-xl border border-github-border flex items-center gap-4 hover:border-github-accent/50 transition-all hover:-translate-y-0.5 group";
                    
                    card.innerHTML = `
                        <div class="relative">
                            <img src="${user.avatar_url}" alt="${user.login}" class="w-12 h-12 rounded-full border-2 border-github-border group-hover:border-github-accent/50 transition-colors">
                            <div class="absolute -bottom-1 -right-1 bg-[#0d1117] rounded-full p-0.5">
                                <div class="bg-green-500 w-2.5 h-2.5 rounded-full border border-[#0d1117]"></div>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <a href="${user.html_url}" target="_blank" class="text-white font-medium hover:text-github-accent truncate block text-sm">${user.login}</a>
                            <div class="text-xs text-github-muted mt-0.5 flex items-center gap-1">
                                <i data-lucide="git-merge" class="w-3 h-3"></i>
                                ${user.contributions} commits
                            </div>
                        </div>
                        <a href="${user.html_url}" target="_blank" class="p-2 text-github-muted hover:text-white bg-white/5 hover:bg-white/10 rounded-lg transition-colors">
                            <i data-lucide="external-link" class="w-4 h-4"></i>
                        </a>
                    `;
                    els.collaboratorsGrid.appendChild(card);
                });

                lucide.createIcons();
            } catch (err) {
                els.collaboratorsGrid.innerHTML = '';
                els.errorState.classList.remove('hidden');
                els.errorMsg.textContent = err.message;
            }
        }
    </script>
</body>
</html>